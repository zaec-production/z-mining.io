<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>21 ¬∑ Z-–∫–∞–∑–∏–Ω–æ</title>
    <style>
        @font-face {
            font-family: 'Ithaca';
            src: url('res/ofont_Ithaca.ttf') format('truetype');
            font-weight: normal;
            font-style: normal;
        }

        /* ===== –ó–ê–©–ò–¢–ê –û–¢ –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø ===== */
        * {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-touch-callout: none;
        }
        
        input, textarea, .bet-input {
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            user-select: text;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Ithaca', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f0f23, #1a1a3e);
            color: #e0e0e0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .game-container {
            width: 100%;
            max-width: 1000px;
            background: rgba(25, 25, 45, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
            border: 1px solid #00ffff55;
            position: relative;
        }

        h1 {
            color: #00ffff;
            text-shadow: 0 0 10px #00ffff, 0 0 20px #0066ff;
            font-size: 2.8em;
            margin-bottom: 20px;
            text-align: center;
            letter-spacing: 4px;
        }

        .balance-panel {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid #00b3ff;
            border-radius: 12px;
            padding: 15px 25px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .balance-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .balance-label {
            color: #88d0ff;
            font-size: 1em;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .balance-value {
            color: #ffffff;
            font-size: 1.6em;
            font-weight: bold;
        }

        .bet-section {
            background: rgba(0, 180, 255, 0.1);
            border: 1px solid #00b3ff;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .bet-title {
            color: #aaa;
            font-size: 1.1em;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .bet-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }

        .bet-input {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid #00c6ff;
            border-radius: 8px;
            padding: 12px 20px;
            color: white;
            font-size: 1.2em;
            width: 150px;
            text-align: center;
        }

        .bet-input:focus {
            outline: none;
            box-shadow: 0 0 15px #00ffff;
        }

        button {
            background: linear-gradient(45deg, #00b3ff, #0077ff);
            color: white;
            border: none;
            padding: 12px 28px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0, 180, 255, 0.3);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        button:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 180, 255, 0.5);
        }

        button:active:not(:disabled) {
            transform: scale(0.96);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #444;
        }

        .deal-btn {
            background: linear-gradient(45deg, #00ff9d, #00b366);
            min-width: 200px;
            font-size: 1.4em;
            padding: 15px 40px;
        }

        .game-table {
            display: flex;
            flex-direction: column;
            gap: 40px;
            margin: 30px 0;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            border: 1px solid #448aff;
        }

        .player-area, .dealer-area {
            text-align: left;
        }

        .area-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            color: #88d0ff;
            font-size: 1.3em;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .cards {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            min-height: 120px;
        }

        .card {
            background: linear-gradient(145deg, #ffffff, #e6e9f0);
            border-radius: 12px;
            padding: 15px 20px;
            box-shadow: 0 8px 0 #0a0a1a, 0 10px 20px black;
            color: #0a0a1a;
            font-size: 2.2em;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 80px;
            height: 110px;
            border: 2px solid #00ffff;
            opacity: 0;
            animation: cardAppear 0.4s ease-out forwards;
        }

        .card-red {
            color: #e63946;
        }

        .card-black {
            color: #1e1e2f;
        }

        @keyframes cardAppear {
            0% { opacity: 0; transform: translateY(-30px) rotate(-5deg); }
            100% { opacity: 1; transform: translateY(0) rotate(0); }
        }

        .result-area {
            text-align: center;
            font-size: 1.6em;
            margin: 20px 0;
            padding: 20px;
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.6);
            border-left: 8px solid #00ffff;
            color: #ffffff;
            text-shadow: 0 0 5px #00ffff;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-style: italic;
        }

        .win {
            color: #b0ff8c;
            border-left-color: #00ff88;
        }

        .lose {
            color: #ff8c8c;
            border-left-color: #ff4444;
        }

        .draw {
            color: #ffd700;
            border-left-color: #ffaa00;
        }

        .action-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .hit-btn {
            background: linear-gradient(45deg, #ff9900, #ff6600);
        }

        .stand-btn {
            background: linear-gradient(45deg, #ff6b6b, #ff3b3b);
        }

        .return-btn {
            background: linear-gradient(45deg, #4caf50, #2e7d32);
            margin-top: 20px;
        }

        .footer {
            margin-top: 30px;
            color: #aaa;
            font-size: 0.9em;
            text-align: center;
            opacity: 0.8;
        }

        .effect-coin {
            position: fixed;
            color: #ffd700;
            font-size: 26px;
            font-weight: bold;
            pointer-events: none;
            z-index: 9999;
            animation: coinFly 1s forwards;
            text-shadow: 0 0 5px #ffaa00;
        }

        @keyframes coinFly {
            0% { opacity: 1; transform: scale(1) translateY(0); }
            100% { opacity: 0; transform: scale(1.8) translateY(-60px); }
        }

        .dealer-thinking {
            color: #88d0ff;
            font-style: italic;
            margin-top: 10px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.6; }
            50% { opacity: 1; }
            100% { opacity: 0.6; }
        }

        #masterVolumeSlider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 15px #00ffff, 0 0 5px #00aaff;
            border: 2px solid #00ffff;
            transition: 0.1s;
        }
        #masterVolumeSlider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            background: #00ffff;
        }
        #masterVolumeSlider::-moz-range-thumb {
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 0 15px #00ffff;
            border: 2px solid #00ffff;
        }
        #volumeSliderWrapper {
            animation: slideIn 0.2s ease-out;
        }
        #volumeIconBtn.muted {
            opacity: 0.5;
            filter: grayscale(0.5);
        }

        @media (max-width: 768px) {
            .game-container { padding: 20px; }
            h1 { font-size: 2.2em; }
            .card { font-size: 1.8em; min-width: 65px; height: 95px; }
            .result-area { font-size: 1.2em; }
            .bet-input { width: 120px; }
        }
    </style>
    
    <script>
        // ===== –ó–ê–©–ò–¢–ê –û–¢ –ö–û–ü–ò–†–û–í–ê–ù–ò–Ø =====
        document.addEventListener('DOMContentLoaded', function() {
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                return false;
            });
            
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && (e.keyCode === 67 || e.keyCode === 86 || e.keyCode === 88 || 
                    e.keyCode === 65 || e.keyCode === 83 || e.keyCode === 80)) {
                    e.preventDefault();
                    return false;
                }
                
                if (e.keyCode === 123 || 
                    (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74)) ||
                    (e.ctrlKey && e.keyCode === 85)) {
                    e.preventDefault();
                    return false;
                }
            });
            
            document.addEventListener('dragstart', function(e) {
                e.preventDefault();
                return false;
            });
            
            document.addEventListener('selectstart', function(e) {
                e.preventDefault();
                return false;
            });
            
            document.addEventListener('copy', function(e) {
                e.preventDefault();
                e.clipboardData.setData('text/plain', '');
                return false;
            });
            
            document.addEventListener('cut', function(e) {
                e.preventDefault();
                return false;
            });
            
            document.addEventListener('paste', function(e) {
                e.preventDefault();
                return false;
            });
        });
    </script>
</head>
<body>
    <div class="game-container">
        <h1>‚ô† 21 ‚ô•</h1>
        
        <div class="balance-panel">
            <div class="balance-item">
                <span class="balance-label">–ë–∞–ª–∞–Ω—Å</span>
                <span id="usdBalance" class="balance-value">0.00 $</span>
            </div>
            <div class="balance-item">
                <span class="balance-label">–°—Ç–∞–≤–∫–∞</span>
                <span id="currentBetDisplay" class="balance-value" style="color: #ffd700;">0.00 $</span>
            </div>
        </div>

        <div class="bet-section">
            <span class="bet-title">–í–∞—à–∞ —Å—Ç–∞–≤–∫–∞</span>
            <div class="bet-controls">
                <input type="number" id="betAmount" class="bet-input" value="10" min="1" step="1" placeholder="–°—É–º–º–∞">
                <button id="dealBtn" class="deal-btn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
            </div>
        </div>

        <div class="game-table">
            <div class="dealer-area">
                <div class="area-header">
                    <span>–î–∏–ª–µ—Ä</span>
                    <span id="dealerScore">‚Äî</span>
                </div>
                <div id="dealerCards" class="cards"></div>
                <div id="dealerThinking" class="dealer-thinking"></div>
            </div>
            
            <div class="player-area">
                <div class="area-header">
                    <span>–ò–≥—Ä–æ–∫</span>
                    <span id="playerScore">‚Äî</span>
                </div>
                <div id="playerCards" class="cards"></div>
            </div>
        </div>

        <div id="resultMessage" class="result-area">üÉè –°–¥–µ–ª–∞–π—Ç–µ —Å—Ç–∞–≤–∫—É, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å</div>

        <div class="action-buttons">
            <button id="hitBtn" class="hit-btn" disabled>–í–∑—è—Ç—å –∫–∞—Ä—Ç—É</button>
            <button id="standBtn" class="stand-btn" disabled>–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è</button>
        </div>

        <div style="display: flex; justify-content: center;">
            <button id="returnBtn" class="return-btn">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ Z‚Äë–º–∞–π–Ω–∏–Ω–≥</button>
        </div>
        
        <div class="footer">
            <p>21 ‚Ä¢ —Ü–µ–ª—å ‚Äî –Ω–∞–±—Ä–∞—Ç—å 21 –∏–ª–∏ –±—ã—Ç—å –±–ª–∏–∂–µ –∫ 21, —á–µ–º –¥–∏–ª–µ—Ä ‚Ä¢ —Ç—É–∑ = 1 –∏–ª–∏ 11</p>
            <p>–≤—ã–∏–≥—Ä—ã—à: x2 —Å—Ç–∞–≤–∫–∏ ‚Ä¢ –Ω–∏—á—å—è: –≤–æ–∑–≤—Ä–∞—Ç —Å—Ç–∞–≤–∫–∏</p>
        </div>
    </div>

    <!-- ========== –†–ï–ì–£–õ–Ø–¢–û–† –ì–†–û–ú–ö–û–°–¢–ò ========== -->
    <div id="volumeControlContainer" style="
        position: fixed;
        bottom: 10px;
        left: 10px;
        background: rgba(25, 25, 45, 0.9);
        backdrop-filter: blur(10px);
        border: 1px solid #00b3ff;
        border-radius: 40px;
        padding: 8px 20px;
        display: flex;
        align-items: center;
        gap: 15px;
        z-index: 950;
        box-shadow: 0 0 20px rgba(0, 180, 255, 0.3);
        transition: all 0.3s;
    ">
        <button id="volumeIconBtn" style="
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(0, 180, 255, 0.2);
            transition: 0.2s;
            color: #88d0ff;
            box-shadow: 0 0 5px rgba(0,180,255,0.5);
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        ">üîä</button>

        <div id="volumeSliderWrapper" style="
            display: none;
            align-items: center;
            gap: 12px;
            background: rgba(0, 0, 0, 0.6);
            padding: 8px 18px;
            border-radius: 30px;
            border: 1px solid #00ffff;
        ">
            <span style="color: #00ffff; font-size: 1.1em; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;">–ì—Ä–æ–º–∫–æ—Å—Ç—å</span>
            <input type="range" id="masterVolumeSlider" min="0" max="100" value="70" step="5" style="
                width: 160px;
                height: 8px;
                -webkit-appearance: none;
                background: linear-gradient(90deg, #00c6ff, #0077ff);
                border-radius: 10px;
                outline: none;
            ">
            <span id="volumePercent" style="color: white; font-weight: bold; min-width: 45px; background: #0a0a1a; padding: 4px 8px; border-radius: 20px; text-align: center; border: 1px solid #00b3ff; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;">70%</span>
        </div>
    </div>

    <script>
        // -----------------------------
        // –ó–í–£–ö–ò
        // -----------------------------
        const cardSound = new Audio('res/click.wav');
        const winSound = new Audio('res/win.mp3');
        const loseSound = new Audio('res/lose.mp3');
        const chipSound = new Audio('res/coin_buy.mp3');
        const ambientSound = new Audio('res/stardust.mp3');
        
        const legendarySounds = [
            new Audio('res/kazinobleat.mp3'),
            new Audio('res/kazinobleat1.mp3'),
            new Audio('res/kazinobleat2.mp3'),
            new Audio('res/kazinobleat3.mp3')
        ];

        cardSound.volume = 0.5;
        winSound.volume = 0.8;
        loseSound.volume = 0.7;
        chipSound.volume = 0.6;
        ambientSound.volume = 0.3;
        ambientSound.loop = true;
        
        legendarySounds.forEach(sound => {
            sound.volume = 0.7;
        });

        // -----------------------------
        // –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï
        // -----------------------------
        let gameData = { usdBalance: 10.00 };
        let currentBet = 10;
        let playerHand = [];
        let dealerHand = [];
        let gameActive = false;
        let cardDelay = 400;

        // -----------------------------
        // –ó–ê–ì–†–£–ó–ö–ê –ò –°–û–•–†–ê–ù–ï–ù–ò–ï
        // -----------------------------
        function loadBalance() {
            try {
                const saved = localStorage.getItem('zMining');
                if (saved) {
                    const parsed = JSON.parse(saved);
                    if (typeof parsed.usdBalance === 'number') {
                        gameData.usdBalance = parsed.usdBalance;
                    }
                }
            } catch (e) {}
            gameData.usdBalance = Math.round(gameData.usdBalance * 100) / 100;
            updateBalanceUI();
        }

        function saveBalance() {
            try {
                const saved = localStorage.getItem('zMining');
                let gameState = saved ? JSON.parse(saved) : {};
                gameState.usdBalance = gameData.usdBalance;
                localStorage.setItem('zMining', JSON.stringify(gameState));
            } catch (e) {}
        }

        function updateBalanceUI() {
            document.getElementById('usdBalance').textContent = gameData.usdBalance.toFixed(2) + ' $';
            document.getElementById('currentBetDisplay').textContent = currentBet.toFixed(2) + ' $';
        }

        // -----------------------------
        // –§–£–ù–ö–¶–ò–ò –ö–ê–†–¢
        // -----------------------------
        function getRandomCard() {
            const ranks = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
            const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
            const rank = ranks[Math.floor(Math.random() * ranks.length)];
            const suit = suits[Math.floor(Math.random() * suits.length)];
            
            let value = 0;
            if (rank === 'A') value = 11;
            else if (['J', 'Q', 'K'].includes(rank)) value = 10;
            else value = parseInt(rank);
            
            return { rank, suit, value };
        }

        function calculateScore(hand) {
            let score = 0;
            let aces = 0;
            hand.forEach(card => {
                score += card.value;
                if (card.rank === 'A') aces++;
            });
            while (score > 21 && aces > 0) {
                score -= 10;
                aces--;
            }
            return score;
        }

        async function addCardWithDelay(container, card, isPlayer = true) {
            return new Promise(resolve => {
                setTimeout(() => {
                    const cardEl = document.createElement('div');
                    cardEl.className = 'card';
                    if (card.suit === '‚ô•' || card.suit === '‚ô¶') {
                        cardEl.classList.add('card-red');
                    } else {
                        cardEl.classList.add('card-black');
                    }
                    cardEl.textContent = `${card.rank}${card.suit}`;
                    container.appendChild(cardEl);
                    
                    cardSound.play().catch(e => {});
                    
                    if (isPlayer) {
                        document.getElementById('playerScore').textContent = `–û—á–∫–∏: ${calculateScore(playerHand)}`;
                    } else {
                        document.getElementById('dealerScore').textContent = `–û—á–∫–∏: ${calculateScore(dealerHand)}`;
                    }
                    
                    resolve();
                }, cardDelay);
            });
        }

        function clearTable() {
            document.getElementById('playerCards').innerHTML = '';
            document.getElementById('dealerCards').innerHTML = '';
            document.getElementById('playerScore').textContent = '‚Äî';
            document.getElementById('dealerScore').textContent = '‚Äî';
            document.getElementById('dealerThinking').innerHTML = '';
        }

        function playRandomLegendarySound() {
            const randomIndex = Math.floor(Math.random() * legendarySounds.length);
            const sound = legendarySounds[randomIndex];
            sound.currentTime = 0;
            sound.play().catch(e => console.log('–õ–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –∑–≤—É–∫ –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥—ë–Ω:', e));
        }

        // -----------------------------
        // –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê
        // -----------------------------
        async function startRound() {
            const betInput = document.getElementById('betAmount');
            let bet = parseFloat(betInput.value);
            if (isNaN(bet) || bet < 1) bet = 1;
            
            if (bet > gameData.usdBalance) {
                alert(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ USD. –ë–∞–ª–∞–Ω—Å: ${gameData.usdBalance.toFixed(2)}$`);
                return;
            }
            
            gameData.usdBalance -= bet;
            gameData.usdBalance = Math.round(gameData.usdBalance * 100) / 100;
            currentBet = bet;
            saveBalance();
            updateBalanceUI();
            
            chipSound.play().catch(e => {});
            
            clearTable();
            
            gameActive = true;
            document.getElementById('dealBtn').disabled = true;
            document.getElementById('hitBtn').disabled = false;
            document.getElementById('standBtn').disabled = false;
            
            document.getElementById('resultMessage').textContent = 'üÉè –î–∏–ª–µ—Ä —Ç–∞—Å—É–µ—Ç –∫–æ–ª–æ–¥—É...';
            await new Promise(r => setTimeout(r, 600));
            
            playerHand = [getRandomCard(), getRandomCard()];
            dealerHand = [getRandomCard(), getRandomCard()];
            
            const playerContainer = document.getElementById('playerCards');
            document.getElementById('resultMessage').textContent = 'üé¥ –í–∞–º —Å–¥–∞–Ω–∞ –ø–µ—Ä–≤–∞—è –∫–∞—Ä—Ç–∞...';
            await addCardWithDelay(playerContainer, playerHand[0], true);
            
            document.getElementById('resultMessage').textContent = 'üé¥ –í—Ç–æ—Ä–∞—è –∫–∞—Ä—Ç–∞...';
            await addCardWithDelay(playerContainer, playerHand[1], true);
            
            document.getElementById('resultMessage').textContent = 'üÇ† –î–∏–ª–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç—É...';
            const dealerContainer = document.getElementById('dealerCards');
            await addCardWithDelay(dealerContainer, dealerHand[0], false);
            
            setTimeout(() => {
                const hiddenCard = document.createElement('div');
                hiddenCard.className = 'card';
                hiddenCard.style.background = 'linear-gradient(145deg, #2a2a4a, #1a1a3a)';
                hiddenCard.style.color = 'transparent';
                hiddenCard.style.border = '2px solid #88d0ff';
                hiddenCard.textContent = '?';
                dealerContainer.appendChild(hiddenCard);
                document.getElementById('dealerScore').textContent = '?';
            }, cardDelay);
            
            setTimeout(() => {
                document.getElementById('resultMessage').textContent = '‚ú® –í–∞—à —Ö–æ–¥. –í–æ–∑—å–º—ë—Ç–µ –∫–∞—Ä—Ç—É?';
            }, cardDelay * 2);
            
            setTimeout(() => {
                if (calculateScore(playerHand) === 21) {
                    document.getElementById('resultMessage').textContent = 'üéØ –ë–ª—ç–∫–¥–∂–µ–∫! –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞.';
                    stand();
                }
            }, cardDelay * 3);
        }

        async function hit() {
            if (!gameActive) return;
            
            document.getElementById('resultMessage').textContent = 'üé¥ –í—ã –±–µ—Ä—ë—Ç–µ –∫–∞—Ä—Ç—É...';
            
            const newCard = getRandomCard();
            playerHand.push(newCard);
            
            const playerContainer = document.getElementById('playerCards');
            await addCardWithDelay(playerContainer, newCard, true);
            
            const playerScore = calculateScore(playerHand);
            
            if (playerScore > 21) {
                document.getElementById('resultMessage').textContent = 'üíî –ü–µ—Ä–µ–±–æ—Ä. –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏.';
                endRound('lose', '–ü–µ—Ä–µ–±–æ—Ä. –í—ã –ø—Ä–æ–∏–≥—Ä–∞–ª–∏.');
            } else {
                document.getElementById('resultMessage').textContent = `‚úÖ –£ –≤–∞—Å ${playerScore} –æ—á–∫–æ–≤. –ü—Ä–æ–¥–æ–ª–∂–∏–º?`;
            }
        }

        async function stand() {
            if (!gameActive) return;
            
            gameActive = false;
            document.getElementById('hitBtn').disabled = true;
            document.getElementById('standBtn').disabled = true;
            
            document.getElementById('resultMessage').textContent = '‚è≥ –î–∏–ª–µ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –∫–∞—Ä—Ç—ã...';
            
            const dealerContainer = document.getElementById('dealerCards');
            dealerContainer.innerHTML = '';
            
            await addCardWithDelay(dealerContainer, dealerHand[0], false);
            await addCardWithDelay(dealerContainer, dealerHand[1], false);
            
            document.getElementById('dealerThinking').innerHTML = 'üé≤ –î–∏–ª–µ—Ä –¥—É–º–∞–µ—Ç...';
            
            while (calculateScore(dealerHand) < 17) {
                await new Promise(r => setTimeout(r, 800));
                document.getElementById('resultMessage').textContent = 'üé≤ –î–∏–ª–µ—Ä –±–µ—Ä—ë—Ç –∫–∞—Ä—Ç—É...';
                
                const newCard = getRandomCard();
                dealerHand.push(newCard);
                await addCardWithDelay(dealerContainer, newCard, false);
            }
            
            document.getElementById('dealerThinking').innerHTML = '';
            
            const playerScore = calculateScore(playerHand);
            const dealerScore = calculateScore(dealerHand);
            
            if (dealerScore > 21) {
                endRound('win', `üéâ –î–∏–ª–µ—Ä –ø–µ—Ä–µ–±—Ä–∞–ª! –í—ã –≤—ã–∏–≥—Ä–∞–ª–∏ ${(currentBet * 2).toFixed(2)}$`);
            } else if (playerScore > dealerScore) {
                endRound('win', `üèÜ –í–∞—à–∏ ${playerScore} –ø—Ä–æ—Ç–∏–≤ ${dealerScore} –¥–∏–ª–µ—Ä–∞. –í—ã–∏–≥—Ä—ã—à: ${(currentBet * 2).toFixed(2)}$`);
            } else if (playerScore < dealerScore) {
                endRound('lose', `üìâ –í–∞—à–∏ ${playerScore} –ø—Ä–æ—Ç–∏–≤ ${dealerScore} –¥–∏–ª–µ—Ä–∞. –ü—Ä–æ–∏–≥—Ä—ã—à.`);
                playRandomLegendarySound();
            } else {
                endRound('draw', `ü§ù –ù–∏—á—å—è. –í–∞—à–∞ —Å—Ç–∞–≤–∫–∞ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∞.`);
            }
        }

        function endRound(result, message) {
            gameActive = false;
            document.getElementById('hitBtn').disabled = true;
            document.getElementById('standBtn').disabled = true;
            document.getElementById('dealBtn').disabled = false;
            
            const resultDiv = document.getElementById('resultMessage');
            resultDiv.textContent = message;
            resultDiv.classList.remove('win', 'lose', 'draw');
            
            if (result === 'win') {
                const winAmount = currentBet * 2;
                gameData.usdBalance += winAmount;
                gameData.usdBalance = Math.round(gameData.usdBalance * 100) / 100;
                resultDiv.classList.add('win');
                winSound.play().catch(e => {});
                
                for (let i = 0; i < 10; i++) {
                    setTimeout(() => {
                        const coin = document.createElement('div');
                        coin.className = 'effect-coin';
                        coin.textContent = `+${winAmount.toFixed(2)}$`;
                        coin.style.left = Math.random() * window.innerWidth + 'px';
                        coin.style.top = Math.random() * window.innerHeight + 'px';
                        document.body.appendChild(coin);
                        setTimeout(() => coin.remove(), 1000);
                    }, i * 50);
                }
            } else if (result === 'lose') {
                resultDiv.classList.add('lose');
                loseSound.play().catch(e => {});
            } else if (result === 'draw') {
                gameData.usdBalance += currentBet;
                gameData.usdBalance = Math.round(gameData.usdBalance * 100) / 100;
                resultDiv.classList.add('draw');
            }
            
            saveBalance();
            updateBalanceUI();
        }

        function returnToMining() {
            saveBalance();
            window.location.href = 'index.html';
        }

        // -----------------------------
        // –†–ï–ì–£–õ–Ø–¢–û–† –ì–†–û–ú–ö–û–°–¢–ò
        // -----------------------------
        (function initVolumeControl() {
            const volumeIcon = document.getElementById('volumeIconBtn');
            const sliderWrapper = document.getElementById('volumeSliderWrapper');
            const volumeSlider = document.getElementById('masterVolumeSlider');
            const volumePercent = document.getElementById('volumePercent');
            
            let savedVolume = localStorage.getItem('zMiningVolume');
            if (savedVolume === null) savedVolume = 70;
            else savedVolume = parseInt(savedVolume);
            
            volumeSlider.value = savedVolume;
            volumePercent.textContent = savedVolume + '%';
            
            function setGlobalVolume(volumePercent) {
                const volume = volumePercent / 100;
                cardSound.volume = volume * 0.5;
                winSound.volume = volume * 0.8;
                loseSound.volume = volume * 0.7;
                chipSound.volume = volume * 0.6;
                ambientSound.volume = volume * 0.3;
                legendarySounds.forEach(sound => {
                    sound.volume = volume * 0.7;
                });
                localStorage.setItem('zMiningVolume', volumePercent);
                
                if (volumePercent === 0) {
                    volumeIcon.textContent = 'üîá';
                    volumeIcon.classList.add('muted');
                } else if (volumePercent < 30) {
                    volumeIcon.textContent = 'üîà';
                    volumeIcon.classList.remove('muted');
                } else if (volumePercent < 70) {
                    volumeIcon.textContent = 'üîâ';
                    volumeIcon.classList.remove('muted');
                } else {
                    volumeIcon.textContent = 'üîä';
                    volumeIcon.classList.remove('muted');
                }
            }
            
            setGlobalVolume(savedVolume);
            
            volumeSlider.addEventListener('input', function(e) {
                volumePercent.textContent = e.target.value + '%';
            });
            
            volumeSlider.addEventListener('change', function(e) {
                setGlobalVolume(parseInt(e.target.value));
            });
            
            volumeIcon.addEventListener('click', function(e) {
                e.stopPropagation();
                sliderWrapper.style.display = sliderWrapper.style.display === 'flex' ? 'none' : 'flex';
            });
            
            document.addEventListener('click', function(e) {
                const container = document.getElementById('volumeControlContainer');
                if (container && !container.contains(e.target) && sliderWrapper.style.display === 'flex') {
                    sliderWrapper.style.display = 'none';
                }
            });
            
            document.getElementById('volumeControlContainer').addEventListener('click', function(e) {
                e.stopPropagation();
            });
        })();

        // -----------------------------
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        // -----------------------------
        window.addEventListener('load', () => {
            loadBalance();
            updateBalanceUI();
            ambientSound.play().catch(e => {});
            
            document.getElementById('dealBtn').addEventListener('click', startRound);
            document.getElementById('hitBtn').addEventListener('click', hit);
            document.getElementById('standBtn').addEventListener('click', stand);
            document.getElementById('returnBtn').addEventListener('click', returnToMining);
            
            setInterval(() => loadBalance(), 3000);
        });
    </script>
</body>
</html>